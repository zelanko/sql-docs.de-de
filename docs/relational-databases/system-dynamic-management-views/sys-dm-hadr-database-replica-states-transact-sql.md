---
title: sys. dm_hadr_database_replica_states (Transact-SQL) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/26/2018
ms.prod: sql
ms.reviewer: ''
ms.technology: system-objects
ms.topic: language-reference
f1_keywords:
- sys.dm_hadr_database_states_TSQL
- sys.dm_hadr_database_states
- dm_hadr_database_states
- dm_hadr_database_states_TSQL
dev_langs:
- TSQL
helpviewer_keywords:
- Availability Groups [SQL Server], monitoring
- sys.dm_hadr_database_replica_states dynamic management view
ms.assetid: 1a17b0c9-2535-4f3d-8013-cd0a6d08f773
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 83b3c369add51a853078dd64a8861d633ac330ec
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 02/08/2020
ms.locfileid: "73982275"
---
# <a name="sysdm_hadr_database_replica_states-transact-sql"></a>sys.dm_hadr_database_replica_states (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2012-xxxx-xxxx-xxx-md](../../includes/tsql-appliesto-ss2012-xxxx-xxxx-xxx-md.md)]

  Gibt eine Zeile für jede Datenbank zurück, die an einer Always on Verfügbarkeits Gruppe teilnimmt, für die die [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] lokale Instanz von ein Verfügbarkeits Replikat hostet. Diese dynamische Verwaltungssicht macht Statusinformationen für sowohl primäre als auch sekundäre Replikate verfügbar. Auf einem sekundären Replikat gibt diese Sicht eine Zeile für jede sekundäre Datenbank der Serverinstanz zurück. Auf dem primären Replikat gibt diese Sicht eine Zeile für jede primäre Datenbank und eine zusätzliche Zeile für die entsprechende sekundäre Datenbank zurück.  
  
> [!IMPORTANT]
> Abhängig von der Aktion und den Statuswerten auf höherer Ebene sind Datenbankstatusinformationen möglicherweise nicht verfügbar oder veraltet. Zudem sind die Werte nur lokal relevant. Beispielsweise werden auf dem primären Replikat der Wert der Spalte **last_hardened_lsn** die Informationen zu einer bestimmten sekundären Datenbank, die derzeit für das primäre Replikat verfügbar ist, und nicht den tatsächlichen festgelegten LSN-Wert, den das sekundäre Replikat derzeit aufweisen kann, angezeigt.  
   
|Spaltenname|Datentyp|Beschreibung (auf primärem Replikat)|  
|-----------------|---------------|----------------------------------------|  
|**database_id**|**int**|Der Bezeichner der Datenbank, der innerhalb einer Instanz von SQL Server eindeutig ist. Dies ist derselbe Wert, der in der [sys. Datenbanken](../../relational-databases/system-catalog-views/sys-databases-transact-sql.md) -Katalog Sicht angezeigt wird.|  
|**group_id**|**uniqueidentifier**|Der Bezeichner der Verfügbarkeitsgruppe, zu der die Datenbank gehört.|  
|**replica_id**|**uniqueidentifier**|Der Bezeichner des Verfügbarkeitsreplikats in der Verfügbarkeitsgruppe.|  
|**group_database_id**|**uniqueidentifier**|Der Bezeichner der Datenbank in der Verfügbarkeitsgruppe. Dieser Bezeichner ist auf jedem Replikat, mit dem diese Datenbank verknüpft ist, identisch.|  
|**is_local**|**bit**|Gibt an, ob die Verfügbarkeitsdatenbank lokal ist. Folgende Werte sind möglich:<br /><br /> 0 = Die Datenbank ist für die [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]-Instanz nicht lokal.<br /><br /> 1 = Die Datenbank ist für die Serverinstanz lokal.|  
|**is_primary_replica**|**bit**|Gibt 1 zurück, wenn das Replikat primär ist, oder 0 bei einem sekundären Replikat.<br /><br />**Gilt für:** [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] und höher.|  
|**synchronization_state**|**tinyint**|Status der Daten Verschiebung, einer der folgenden Werte.<br /><br /> 0 = die Synchronisierung wird nicht durchgeführt. Gibt bei einer primären Datenbank an, dass die Datenbank nicht bereit ist, das Transaktionsprotokoll mit den entsprechenden sekundären Datenbanken zu synchronisieren. Gibt bei einer sekundären Datenbank an, dass die Protokollsynchronisierung für die Datenbank aufgrund eines Verbindungsproblems nicht gestartet wurde oder beim Start oder einem Rollenwechsel verschiedene Übergangsstatuswerte durchläuft.<br /><br /> 1 = wird synchronisiert. Gibt bei einer primären Datenbank an, dass diese Datenbank bereit ist, eine Scananforderung von einer sekundären Datenbank zu akzeptieren. Gibt bei einer sekundären Datenbank an, dass eine aktive Datenverschiebung für die Datenbank erfolgt.<br /><br /> 2 = synchronisiert. Primäre Datenbanken werden mit dem Status SYNCHRONISIERT und nicht mit dem Status WIRD SYNCHRONISIERT angezeigt. Eine sekundäre Datenbank mit synchronem Commit wird als SYNCHRONISIERT angezeigt, wenn gemäß dem lokalen Cache die Datenbank für das Failover bereit ist und eine Synchronisierung erfolgt.<br /><br /> 3 = wird wieder hergestellt. Gibt die Rollbackphase an, wenn eine sekundäre Datenbank aktiv Seiten von der primären Datenbank abruft.<br />**Vorsicht:** Wenn eine Datenbank auf einem sekundären Replikat den Status reverting aufweist, wird durch das Erzwingen eines Failovers zum sekundären Replikat die Datenbank in einem Zustand belassen, in dem Sie nicht als primäre Datenbank gestartet werden kann. Entweder muss erneut eine Verbindung mit der Datenbank als sekundäre Datenbank hergestellt werden, oder Sie müssen neue Protokolldatensätze aus einer Protokollsicherung übernehmen.<br /><br /> 4 = wird initialisiert. Gibt die Rollbackphase an, wenn das Transaktionsprotokoll (erforderlich, um eine sekundäre Datenbank auf den gleichen Stand wie die Rückgängig-LSN zu bringen) übermittelt und auf einem sekundären Replikat festgeschrieben wird.<br />**Vorsicht:** Wenn sich eine Datenbank auf einem sekundären Replikat im Initialisierungs Status befindet, wird durch das Erzwingen eines Failovers zum sekundären Replikat die Datenbank in einem Zustand belassen, in dem Sie nicht als primäre Datenbank gestartet werden kann. Entweder muss erneut eine Verbindung mit der Datenbank als sekundäre Datenbank hergestellt werden, oder Sie müssen neue Protokolldatensätze aus einer Protokollsicherung übernehmen.|  
|**synchronization_state_desc**|**nvarchar (60)**|Beschreibung des Datenverschiebungsstatus. Folgende Werte sind möglich:<br /><br /> NOT SYNCHRONIZING<br /><br /> SYNCHRONIZING<br /><br /> SYNCHRONIZED<br /><br /> REVERTING<br /><br /> INITIALIZING|  
|**is_commit_participant**|**bit**|0 = Ein Transaktionscommit wird nicht in Bezug auf diese Datenbank synchronisiert.<br /><br /> 1 = Ein Transaktionscommit wird in Bezug auf diese Datenbank synchronisiert.<br /><br /> Für eine Datenbank mit einem Verfügbarkeitsreplikat für asynchrone Commits muss dieser Wert immer 0 sein.<br /><br /> Bei einer Datenbank mit einem Verfügbarkeitsreplikat für synchrone Commits ist dieser Wert nur für die primäre Datenbank genau.|  
|**synchronization_health**|**tinyint**|Gibt die Schnittmenge des Synchronisierungs Status einer Datenbank wieder, die mit der Verfügbarkeits Gruppe auf dem Verfügbarkeits Replikat verknüpft ist, und dem Verfügbarkeits Modus des Verfügbarkeits Replikats (synchroner Commit oder asynchroner Commit-Modus), einer der folgende Werte werden angezeigt.<br /><br /> 0 = nicht fehlerfrei. Der **synchronization_state** der Datenbank ist 0 (keine Synchronisierung).<br /><br /> 1 = teilweise fehlerfrei. Eine Datenbank auf einem Verfügbarkeits Replikat mit synchronem Commit wird als teilweise fehlerfrei angesehen, wenn **synchronization_state** 1 (Synchronisierung) ist.<br /><br /> 2 = fehlerfrei. Eine Datenbank auf einem Verfügbarkeits Replikat mit synchronem Commit wird als fehlerfrei angesehen, wenn **synchronization_state** 2 (synchronisiert) ist und eine Datenbank auf einem Verfügbarkeits Replikat mit asynchronem Commit als fehlerfrei eingestuft wird, wenn **synchronization_state** 1 (Synchronisierung) ist.|  
|**synchronization_health_desc**|**nvarchar (60)**|Beschreibung des **synchronization_health** der Verfügbarkeits Datenbank.<br /><br /> NOT_HEALTHY<br /><br /> PARTIALLY_HEALTHY<br /><br /> HEALTHY|  
|**database_state**|**tinyint**|0 = Online<br /><br /> 1 = Wird wiederhergestellt<br /><br /> 2 = Wird wiederhergestellt<br /><br /> 3 = Wiederherstellung steht aus<br /><br /> 4 = Fehlerverdächtig<br /><br /> 5 = Notfall<br /><br /> 6 = Offline<br /><br /> **Hinweis:** Identisch mit der **State** -Spalte in sys.-Datenbanken.|  
|**database_state_desc**|**nvarchar (60)**|Beschreibung der **database_state** des Verfügbarkeits Replikats.<br /><br /> ONLINE<br /><br /> RESTORING<br /><br /> RECOVERING<br /><br /> RECOVERY_PENDING<br /><br /> SUSPECT<br /><br /> EMERGENCY<br /><br /> OFFLINE<br /><br /> **Hinweis:** Identisch mit **state_desc** Spalte in sys.-Datenbanken.|  
|**is_suspended**|**bit**|Der Status der Datenbank. Folgende Werte sind möglich:<br /><br /> 0 = Fortgesetzt<br /><br /> 1 = Angehalten|  
|**suspend_reason**|**tinyint**|Gibt den Grund für das Anhalten an, wenn die Datenbank angehalten wurde. Folgende Werte sind möglich:<br /><br /> 0 = Benutzeraktion<br /><br /> 1 = Aussetzen für: Partner<br /><br /> 2 = Wiederholen<br /><br /> 3 = Erfassen<br /><br /> 4 = Übernehmen<br /><br /> 5 = Neu starten<br /><br /> 6 = Rückgängig<br /><br /> 7 = Erneute Überprüfung<br /><br /> 8 = Fehler bei der Berechnung des Synchronisierungspunkts des sekundären Replikats|  
|**suspend_reason_desc**|**nvarchar (60)**|Beschreibung des Grunds für das Anhalten der Datenbank. Folgende Werte sind möglich:<br /><br /> SUSPEND_FROM_USER = Die Datenverschiebung wurde von einem Benutzer manuell angehalten.<br /><br /> SUSPEND_FROM_PARTNER = Das Datenbankreplikat wurde nach einem erzwungenen Failover angehalten.<br /><br /> SUSPEND_FROM_REDO = Während der Rollforwardphase ist ein Fehler aufgetreten.<br /><br /> SUSPEND_FROM_APPLY = Beim Schreiben des Protokolls in die Datei ist ein Fehler aufgetreten (siehe Fehlerprotokoll).<br /><br /> SUSPEND_FROM_CAPTURE = Beim Aufzeichnen des Protokolls auf dem primären Replikat ist ein Fehler aufgetreten.<br /><br /> SUSPEND_FROM_RESTART = Das Datenbankreplikat wurde vor dem Neustart der Datenbank angehalten (siehe Fehlerprotokoll).<br /><br /> SUSPEND_FROM_UNDO = Während der Rollbackphase ist ein Fehler aufgetreten (siehe Fehlerprotokoll).<br /><br /> SUSPEND_FROM_REVALIDATION = Beim Wiederherstellen der Verbindung wurde ein Konflikt zwischen Protokolländerungen erkannt (siehe Fehlerprotokoll).<br /><br /> SUSPEND_FROM_XRF_UPDATE = Der allgemeine Protokollpunkt wurde nicht gefunden (siehe Fehlerprotokoll).|  
|**recovery_lsn**|**numerisch (25, 0)**|Beim primären Replikat das Ende des Transaktionsprotokolls, bevor die primäre Datenbank nach einer Wiederherstellung oder einem Failover neue Protokolldatensätze schreibt. Wenn dieser Wert bei einer angegebenen sekundären Datenbank kleiner als die aktuelle festgeschriebene LSN (last_hardened_lsn) ist, ist recovery_lsn der Wert, den die sekundäre Datenbank für die erneute Synchronisierung (d. h. zurücksetzen und erneut initialisieren) verwenden müsste. Wenn dieser Wert größer oder gleich der aktuellen festgeschriebenen LSN ist, wäre eine erneute Synchronisierung unnötig und würde nicht ausgeführt.<br /><br /> **recovery_lsn** reflektiert eine mit Nullen aufgefüllte Protokoll Block-ID. Es ist keine tatsächliche Protokollfolgenummer (LSN). Informationen dazu, wie dieser Wert abgeleitet wird, finden Sie Untergrund Legendes zu [den LSN-Spaltenwerten](#LSNcolumns)weiter unten in diesem Thema.|  
|**truncation_lsn**|**numerisch (25, 0)**|Gibt für das primäre Replikat der primären Datenbank den Mindestwert für die Protokollkürzungs-LSN aller entsprechenden sekundären Datenbanken an. Wenn die lokale Protokollkürzung blockiert wird (z. B. durch einen Sicherungsvorgang), kann diese LSN größer als die lokale Kürzungs-LSN sein.<br /><br /> Stellt bei einer bestimmten sekundären Datenbank den Protokollkürzungspunkt dieser Datenbank dar.<br /><br /> **truncation_lsn** reflektiert eine mit Nullen aufgefüllte Protokoll Block-ID. Es ist keine tatsächliche Protokollfolgenummer.|  
|**last_sent_lsn**|**numerisch (25, 0)**|Der Protokollblockbezeichner, der den Punkt angibt, bis zu den alle Protokollblöcke von der primären Datenbank gesendet wurden. Dies ist die ID des nächsten Protokollblocks, der gesendet wird, und nicht die ID des zuletzt gesendeten Protokollblocks.<br /><br /> **last_sent_lsn** die eine mit Nullen aufgefüllte Protokoll Block-ID widerspiegelt, ist dies keine tatsächliche Protokoll Folge Nummer.|  
|**last_sent_time**|**datetime**|Die Zeit, zu der der letzte Protokollblock gesendet wurde.|  
|**last_received_lsn**|**numerisch (25, 0)**|Die Protokollblock-ID, die den Punkt angibt, bis zu dem alle Protokollblöcke vom sekundären Replikat empfangen wurden, das diese sekundäre Datenbank hostet.<br /><br /> **last_received_lsn** reflektiert eine mit Nullen aufgefüllte Protokoll Block-ID. Es ist keine tatsächliche Protokollfolgenummer.|  
|**last_received_time**|**datetime**|Die Zeit, zu der die in der letzten Meldung empfangene Protokollblock-ID auf dem sekundären Replikat gelesen wurde.|  
|**last_hardened_lsn**|**numerisch (25, 0)**|Start des Protokollblocks, der die Protokolldatensätze der letzten festgeschriebenen LSN für eine sekundären Datenbank enthält.<br /><br /> Für eine primäre Datenbank mit asynchronem Commit oder synchronem Commit, deren aktuelle Richtlinie "Verzögerung" ist, lautet der Wert NULL. Bei anderen primären Datenbanken mit synchronem Commit gibt **last_hardened_lsn** den minimalen Satz der festgeschriebenen LSN für alle sekundären Datenbanken an.<br /><br /> **Hinweis: last_hardened_lsn** reflektiert eine mit Nullen aufgefüllte Protokoll Block-ID. Es ist keine tatsächliche Protokollfolgenummer. Weitere Informationen finden Sie Untergrund Legendes zu [den LSN-Spaltenwerten](#LSNcolumns)weiter unten in diesem Thema.|  
|**last_hardened_time**|**datetime**|Bei einer sekundären Datenbank die Zeit des Protokoll Block Bezeichners für die zuletzt festgeschriebene LSN (**last_hardened_lsn**). Gibt für eine primäre Datenbank die Zeit an, die der festgeschriebenen LSN mit dem Mindestwert entspricht.|  
|**last_redone_lsn**|**numerisch (25, 0)**|Tatsächliche Protokollfolgenummer des letzten Protokolldatensatzes, der zuletzt für die sekundäre Datenbank wiederholt wurde. **last_redone_lsn** ist immer kleiner als **last_hardened_lsn**.|  
|**last_redone_time**|**datetime**|Die Zeit, zu der der letzte Protokolldatensatz in der sekundären Datenbank wiederholt wurde.|  
|**log_send_queue_size**|**BIGINT**|Die Menge der Protokolldatensätze der primären Datenbank, die noch nicht an die sekundären Datenbanken gesendet wurden (in KB).|  
|**log_send_rate**|**BIGINT**|Die durchschnittliche Rate, mit der die primäre Replikat Instanz während des letzten aktiven Zeitraums Daten gesendet hat, in Kilobyte (KB)/Sekunde|  
|**redo_queue_size**|**BIGINT**|Die Größe der Protokolldatensätze in den Protokolldateien des sekundären Replikats, das noch nicht wiederholt wurde (in KB).|  
|**redo_rate**|**BIGINT**|Die durchschnittliche Rate, mit der die Protokolldaten Sätze für eine bestimmte sekundäre Datenbank wiederholt werden, in Kilobyte (KB)/Sekunde|  
|**filestream_send_rate**|**BIGINT**|Die Rate in KB/Sekunde, mit der die FILESTREAM-Dateien an das sekundäre Replikat übertragen werden.|  
|**end_of_log_lsn**|**numerisch (25, 0)**|Lokale Protokollende-LSN. Die tatsächliche LSN, die dem letzten Protokolldatensatz im Protokollcache der primären und sekundären Datenbanken entspricht. Für das primäre Replikat geben die sekundären Zeilen die Protokollende-LSN der letzten Statusmeldungen an, die die sekundären Replikate an das primäre Replikat gesendet haben.<br /><br /> **end_of_log_lsn** reflektiert eine mit Nullen aufgefüllte Protokoll Block-ID. Es ist keine tatsächliche Protokollfolgenummer. Weitere Informationen finden Sie Untergrund Legendes zu [den LSN-Spaltenwerten](#LSNcolumns)weiter unten in diesem Thema.|  
|**last_commit_lsn**|**Numerisch (25, 0)**|Tatsächliche Protokollfolgenummer, die dem letzten Commitdatensatz im Transaktionsprotokoll entspricht.<br /><br /> Entspricht bei der primären Datenbank dem zuletzt verarbeiteten Commitdatensatz. In den Zeilen für sekundäre Datenbanken wird die Protokollfolgenummer angezeigt, die das sekundäre Replikat dem primären Replikat gesendet hat.<br /><br /> Beim sekundären Replikat ist dies der letzte Commitdatensatz, der wiederholt wurde.|  
|**last_commit_time**|**datetime**|Die Zeit, die dem letzten Commitdatensatz entspricht.<br /><br /> Bei der sekundären Datenbank ist diese Zeit mit der für die primäre Datenbank identisch.<br /><br /> Auf dem primären Replikat zeigt jede Zeile für die sekundäre Datenbank die Zeit an, die das sekundäre Replikat, das die sekundäre Datenbank hostet, dem primären Replikat zurückgemeldet hat. Der Unterschied in der Zeit zwischen der Zeile der primären Datenbank und der angegebenen sekundären Datenbankzeile stellt ungefähr die Recovery Point Objective (RPO) dar, wobei angenommen wird, dass der Wiederholungs Prozess abgefangen wurde und dass der Fortschritt an das primäre Replikat zurückgemeldet wurde. vom sekundären Replikat.|  
|**low_water_mark_for_ghosts**|**BIGINT**|Eine monoton steigende Zahl für die Datenbank, die eine Untergrenze angibt, die für das Cleanup inaktiver Datensätze verwendet wurde. Wenn diese Zahl im Zeitverlauf nicht zunimmt, weist dies darauf hin, dass das Cleanup für inaktive Datensätze möglicherweise nicht erfolgt ist. Um zu entscheiden, welche Zeilen mit inaktiven Datensätzen bereinigt werden sollen, verwendet das primäre Replikat den Mindestwert dieser Spalte für alle Verfügbarkeitsreplikate (einschließlich des primären Replikats) für diese Datenbank.|  
|**secondary_lag_seconds**|**BIGINT**|Die Anzahl der Sekunden, die das sekundäre Replikat während der Synchronisierung hinter dem primären Replikat liegt.<br /><br />**Gilt für:** [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)] und höher.|  
  
##  <a name="LSNcolumns"></a>Grundlegendes zu den LSN-Spaltenwerten  
 Die Werte der Spalten **end_of_log_lsn**, **last_hardened_lsn**, **last_received_lsn**, **last_sent_lsn**, **recovery_lsn**und **truncation_lsn** sind keine tatsächlichen Protokoll Folge Nummern (LSNs). Diese Werte stellen eine mit Nullen aufgefüllte Protokollblock-ID dar.  
  
 **end_of_log_lsn**, **last_hardened_lsn**und **recovery_lsn** sind Leerungs-LSNs. Beispielsweise gibt **last_hardened_lsn** den Anfang des nächsten Blocks hinter den Blöcken an, die bereits auf dem Datenträger vorhanden sind.  Alle LSN < den Wert **last_hardened_lsn** auf dem Datenträger.  Die LSN, die für diesen Wert >= ist, werden nicht geleert.  
  
 Von den LSN-Werten, die von **sys. dm_hadr_database_replica_states**zurückgegeben werden, ist nur **last_redone_lsn** eine echte LSN.  
  
## <a name="security"></a>Sicherheit  
  
### <a name="permissions"></a>Berechtigungen  
 Erfordert die VIEW SERVER STATE-Berechtigung auf dem Server.  
  
## <a name="see-also"></a>Weitere Informationen  
 [Always On-Verfügbarkeitsgruppen &#40;SQL Server&#41;](../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md)   
 [Überwachen von Verfügbarkeitsgruppen &#40;Transact-SQL&#41;](../../database-engine/availability-groups/windows/monitor-availability-groups-transact-sql.md)  
  
  
